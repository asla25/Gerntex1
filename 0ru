<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>0ru - Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</title>
<style>
body {
  margin: 0; font-family: "Tajawal", sans-serif; background: linear-gradient(135deg,#0a0a0a,#1a1a1a); color:#fff; overflow-x:hidden;
}
h1,h2,h3,p{margin:0;padding:0;}
button{cursor:pointer;}
.hidden{display:none;}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© */
.card{background:#1c1c1c;border-radius:24px;padding:20px;margin:20px auto;max-width:360px;box-shadow:0 10px 40px rgba(0,0,0,0.3);text-align:center;transition:0.3s;}
.card:hover{box-shadow:0 15px 50px rgba(255,127,80,0.5);}

/* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
input{width:90%;padding:12px;margin:8px 0;border-radius:12px;border:1px solid #333;background:#222;color:#fff;text-align:center;}
input:focus{border-color:#ff7f50;outline:none;}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
button{width:90%;padding:12px;margin:10px 0;border-radius:20px;border:none;background:linear-gradient(90deg,#ff7f50,#ff4500);color:white;font-weight:600;font-size:1em;transition:0.3s;}
button:hover{background:linear-gradient(90deg,#ff4500,#ff7f50);transform:translateY(-2px);}

/* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ */
#timer{font-size:48px;margin:15px 0;}

/* Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© */
#circleContainer{position:relative;width:150px;height:150px;margin:20px auto;}
#circle{width:100%;height:100%;border-radius:50%;border:8px solid #444;position:absolute;top:0;left:0;}
#progress{width:100%;height:100%;border-radius:50%;border:8px solid #ff7f50;clip: rect(0px,150px,150px,75px);transform:rotate(0deg);position:absolute;top:0;left:0;transition:0.3s linear;}

/* Ø§Ù„ØªÙˆØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ */
#topUsers{margin-top:20px;}
.topCard{background:#2a2a2a;border-radius:12px;padding:10px;margin:8px 0;box-shadow:0 5px 15px rgba(0,0,0,0.2);}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª */
#inbox{margin-top:20px;}
.inboxItem{background:#2a2a2a;padding:8px;margin:6px 0;border-radius:10px;display:flex;justify-content:space-between;align-items:center;}
.inboxItem button{width:auto;padding:6px 12px;font-size:0.9em;}
</style>
</head>
<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginSection" class="card">
<h2>ğŸ¯ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</h2>
<input type="text" id="usernameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)">
<input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="loginOrRegister()">Ø§Ø¨Ø¯Ø£</button>
<p id="loginMsg"></p>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="dashboardSection" class="card hidden">
<h2>ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ <span id="userDisplay"></span></h2>
<p>Ù†Ù‚Ø§Ø·Ùƒ: <span id="pointsDisplay">0</span></p>

<!-- Ø³Ø§Ø¹Ø© Ø¯Ø§Ø¦Ø±ÙŠØ© + Ø¹Ø¯Ø§Ø¯ -->
<div id="circleContainer">
<div id="circle"></div>
<div id="progress"></div>
</div>
<div id="timer">0:00</div>
<button onclick="startSession()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
<button onclick="stopSession()">Ø£ÙˆÙ‚Ù</button>

<!-- Ø§Ù„ØªÙˆØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
<div id="topUsers"><h3>Ø§Ù„ØªÙˆØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3><div id="topList"></div></div>

<!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª -->
<div id="inbox"><h3>ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h3><div id="inboxList"></div>
<input type="text" id="friendInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ØµØ¯ÙŠÙ‚"><button onclick="sendChallenge()">Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠ</button>
</div>
</div>

<!-- Ø£ØµÙˆØ§Øª -->
<audio id="pointSound"><source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg"></audio>

<script type="module">
// Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set, get, update, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
apiKey:"AIzaSyChU5K38X_XVieUtJg1xtaL67ZGKIJZE",
authDomain:"uyedbead.firebaseapp.com",
databaseURL:"https://uyedbead-default-rtdb.firebaseio.com/",
projectId:"uyedbead",storageBucket:"uyedbead.firebasestorage.app",
messagingSenderId:"16717948299",appId:"1:16717948299:web:51f8684046f12a04337b8e"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Variables
let username=""; let timer=null; let secondsElapsed=0;

// DOM
const loginSection=document.getElementById("loginSection");
const dashboardSection=document.getElementById("dashboardSection");
const userDisplay=document.getElementById("userDisplay");
const pointsDisplay=document.getElementById("pointsDisplay");
const timerDisplay=document.getElementById("timer");
const topList=document.getElementById("topList");
const inboxList=document.getElementById("inboxList");
const progressCircle=document.getElementById("progress");
const pointSound=document.getElementById("pointSound");

// ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„
window.loginOrRegister=async function(){
const uname=document.getElementById("usernameInput").value.trim();
const email=document.getElementById("emailInput").value.trim();
const pwd=document.getElementById("passwordInput").value.trim();
const loginMsg=document.getElementById("loginMsg");
if(!/^[A-Za-z0-9]+$/.test(uname)){loginMsg.textContent="âŒ Ø§Ù„Ø§Ø³Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙÙ‚Ø·"; return;}
if(!uname||!email||!pwd){loginMsg.textContent="âŒ Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„"; return;}
const userRef=ref(db,"users/"+uname);
const snapshot=await get(userRef);
if(snapshot.exists()){username=uname; loginMsg.textContent="âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"; openDashboard();}
else{await set(userRef,{email:email,password:pwd,points:0,inbox:{}}); username=uname; loginMsg.textContent="ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨"; openDashboard();}
};

// ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
function openDashboard(){
loginSection.classList.add("hidden");
dashboardSection.classList.remove("hidden");
userDisplay.textContent=username;
loadPoints(); loadTopUsers(); loadInbox();
updateBackground();
}

// Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©
window.startSession=function(){
if(timer) return alert("Ø£Ù†Øª ØªØ¯Ø±Ø³ Ø¨Ø§Ù„ÙØ¹Ù„!");
secondsElapsed=0;
timer=setInterval(()=>{
secondsElapsed++;
const minutes=Math.floor(secondsElapsed/60);
const seconds=secondsElapsed%60;
timerDisplay.textContent=`${minutes}:${seconds.toString().padStart(2,"0")}`;
updateProgress(secondsElapsed/3600*360);
if(secondsElapsed===50*60){ if(confirm("ğŸ’¡ Ù‡Ù„ Ø£Ù†Ù‡ÙŠØª Ø§Ù„ØªØ­Ø¯ÙŠØŸ")) addPoint();}
if(secondsElapsed>=60*60){clearInterval(timer);timer=null; addPoint();alert("ğŸ‰ Ø³Ø§Ø¹Ø© ÙƒØ§Ù…Ù„Ø©! ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©");}
},1000);
};
window.stopSession=function(){clearInterval(timer);timer=null;alert("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠ");};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ©
function updateProgress(deg){progressCircle.style.transform=`rotate(${deg}deg)`;}

// Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø·Ø©
function addPoint(){
const userRef=ref(db,"users/"+username+"/points");
get(userRef).then(snap=>{
const current=snap.val()||0; update(ref(db,"users/"+username),{points:current+1});
pointsDisplay.textContent=current+1;
pointSound.play();
updateBackground();
});
}

// Ø§Ù„ØªÙˆØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
function loadTopUsers(){
const usersRef=ref(db,"users/");
onValue(usersRef,snap=>{
const users=snap.val()||{};
const sorted=Object.entries(users).sort((a,b)=>b[1].points-a[1].points).slice(0,3);
topList.innerHTML="";
sorted.forEach(([name,data],i)=>{const div=document.createElement("div");div.className="topCard";div.textContent=`${i+1}. ${name} - Ù†Ù‚Ø§Ø·: ${data.points}`; topList.appendChild(div);});
});
}

// ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª
function loadInbox(){
const inboxRef=ref(db,"users/"+username+"/inbox");
onValue(inboxRef,snap=>{
const inbox=snap.val()||{};
inboxList.innerHTML="";
Object.entries(inbox).forEach(([id,data])=>{
const div=document.createElement("div"); div.className="inboxItem";
div.textContent=`${data.from} ØªØ­Ø¯Ù‰ Ø¹Ù„ÙŠÙƒ`;
const acceptBtn=document.createElement("button"); acceptBtn.textContent="âœ” Ù‚Ø¨ÙˆÙ„"; acceptBtn.onclick=()=>respondChallenge(id,true);
const rejectBtn=document.createElement("button"); rejectBtn.textContent="âœ– Ø±ÙØ¶"; rejectBtn.onclick=()=>respondChallenge(id,false);
div.appendChild(acceptBtn); div.appendChild(rejectBtn);
inboxList.appendChild(div);
});
});
}

// Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠ
window.sendChallenge=function(){
const friend=document.getElementById("friendInput").value.trim(); if(!friend) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… ØµØ¯ÙŠÙ‚");
const challengeRef=ref(db,"users/"+friend+"/inbox"); push(challengeRef,{from:username,status:"pending"}); alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠ!");
};

// Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ
function respondChallenge(id,accept){
const refCh=ref(db,`users/${username}/inbox/${id}`);
update(refCh,{status:accept?"accepted":"rejected"});
alert(accept?"âœ” Ù‚Ø¨Ù„Øª Ø§Ù„ØªØ­Ø¯ÙŠ":"âœ– Ø±ÙØ¶Øª Ø§Ù„ØªØ­Ø¯ÙŠ");
}

// ØªØ­Ù…ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function loadPoints(){
const userRef=ref(db,"users/"+username+"/points");
get(userRef).then(snap=>{pointsDisplay.textContent=snap.val()||0;});
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
function updateBackground(){
const points=parseInt(pointsDisplay.textContent)||0;
const grad1=`hsl(${points*10%360},70%,10%)`;
const grad2=`hsl(${points*10%360},70%,20%)`;
document.body.style.background=`linear-gradient(135deg, ${grad1}, ${grad2})`;
}
</script>
</body>
</html>
